{% extends "base.html" %}

{% block title %}{{ grid.name }} - Football Squares{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('football_squares.static', filename='football_squares/style.css') }}">
{% endblock %}

{% block content %}
<div class="fs-page-wrapper">
    <div class="fs-container">
        <header class="fs-header">
            <div class="fs-brand">
                <span class="fs-brand-icon">üèà</span>
                <span class="fs-brand-text">Football Squares</span>
            </div>
        </header>

        <main class="fs-main">
            <div class="fs-public-header" style="text-align: center; margin-bottom: 2rem;">
                <h1>{{ grid.name }}</h1>
                <p>{{ grid.team1_name }} vs {{ grid.team2_name }}</p>
            </div>

            <div class="fs-dashboard-grid" style="grid-template-columns: 250px 1fr;">
                <div class="fs-sidebar">
                    <section class="fs-card">
                        <h3>Participants</h3>
                        <ul class="fs-participant-list">
                            {% for participant in grid.participants %}
                            <li class="fs-participant-item">
                                <div class="fs-participant-info">
                                    <span class="fs-participant-name">{{ participant.name }}</span>
                                    <span class="fs-participant-count">{{ participant.square_count }} squares</span>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </section>
                </div>

                <div class="fs-main-panel">
                    <section class="fs-card">
                        <div class="fs-card-header">
                            <h3>Scores & Payouts</h3>
                        </div>
                        <div class="fs-scoring-table-wrapper">
                            <table class="fs-scoring-table fs-scoring-table-horizontal">
                                <thead>
                                    <tr>
                                        <th>Period</th>
                                        {% for i in range(1, 6) %}
                                        <th>{{ "OT" if i == 5 else "Q" ~ i }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>{{ grid.team1_name[:10] }}</strong></td>
                                        {% for i in range(1, 6) %}
                                        {% set q = grid.quarters|selectattr('quarter_number', 'equalto', i)|first %}
                                        <td>{{ q.team1_score if q.team1_score is not none else '-' }}</td>
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td><strong>{{ grid.team2_name[:10] }}</strong></td>
                                        {% for i in range(1, 6) %}
                                        {% set q = grid.quarters|selectattr('quarter_number', 'equalto', i)|first %}
                                        <td>{{ q.team2_score if q.team2_score is not none else '-' }}</td>
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td><strong>Prize</strong></td>
                                        {% for i in range(1, 6) %}
                                        {% set q = grid.quarters|selectattr('quarter_number', 'equalto', i)|first %}
                                        <td>{{ q.payout_description or '-' }}</td>
                                        {% endfor %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        {% if participant_summary %}
                        <div class="fs-winner-summary">
                            <h4>Winnings Summary</h4>
                            <div class="fs-summary-grid">
                                {% for name, winnings in participant_summary.items() %}
                                <div class="fs-summary-item">
                                    <strong>{{ name }}:</strong> {{ winnings|join(', ') }}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </section>

                    <section class="fs-card fs-grid-display">
                        <div class="fs-grid-wrapper">
                            <table class="fs-squares-table">
                                <thead>
                                    <tr>
                                        <!-- Team names now scroll away -->
                                        <th colspan="2" style="border: none;"></th>
                                        <th colspan="10" class="fs-axis-team-label" style="background: {{ grid.team1_color_primary }}; color: {{ grid.team1_color_secondary }}; border-radius: 4px 4px 0 0;">
                                            {{ grid.team1_name }}
                                        </th>
                                    </tr>
                                    <tr>
                                        <!-- Sticky Corner for Digits -->
                                        <th colspan="2" class="fs-grid-corner" style="border: none;"></th>
                                        <!-- Team 1 Digits -->
                                        {% set team1_digits = grid.team1_digits.split(',') %}
                                        {% for digit in team1_digits %}
                                        <th class="fs-axis-digit">{{ digit }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% set team2_digits = grid.team2_digits.split(',') %}
                                    {% for y in range(10) %}
                                    <tr>
                                        {% if loop.first %}
                                        <!-- Team 2 Name Sidebar (Now scrolls away) -->
                                        <th rowspan="10" class="fs-axis-team-label fs-axis-team-label-y" style="background: {{ grid.team2_color_primary }}; color: {{ grid.team2_color_secondary }}; border-radius: 4px 0 0 4px;">
                                            <span class="fs-axis-vertical">{{ grid.team2_name }}</span>
                                        </th>
                                        {% endif %}
                                        <!-- Sticky Y-Axis Digit -->
                                        <th class="fs-axis-digit">{{ team2_digits[y] }}</th>
                                        <!-- Squares -->
                                        {% for x in range(10) %}
                                            {% set square = squares_map.get((x, y)) %}
                                            {% set is_winner = false %}
                                            {% for q_num, winner in winners.items() %}
                                                {% if winner.x == x and winner.y == y %}
                                                    {% set is_winner = true %}
                                                {% endif %}
                                            {% endfor %}
                                            <td class="fs-square-cell {% if square and square.participant_id %}assigned{% endif %} {% if is_winner %}is-winner{% endif %}">
                                                <span class="fs-square-participant">{{ square.participant.name if square and square.participant_id else '' }}</span>
                                                {% if is_winner %}
                                                <div class="fs-winner-badge">üèÜ</div>
                                                {% endif %}
                                            </td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}
