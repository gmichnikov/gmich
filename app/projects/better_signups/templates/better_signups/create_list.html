{% extends 'base.html' %}

{% block title %}Create List - Better Signups{% endblock %}

{% block content %}

<div class="auth-page-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">Create New List</h1>
            <p class="auth-subtitle">Create a signup list for events or items</p>
        </div>

        <form method="post" class="auth-form">
            {{ form.hidden_tag() }}
            
            <div class="auth-form-group">
                {{ form.name.label(class="auth-label") }}
                {{ form.name(class="auth-input", placeholder="School Volunteer Signups", autocomplete="off") }}
                <small style="color: #666; font-size: 0.875rem; margin-top: 4px; display: block;">
                    This is the name of your signup list (not your account name)
                </small>
                {% if form.name.errors %}
                    <div class="auth-error-messages">
                        {% for error in form.name.errors %}
                            <span class="auth-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="auth-form-group">
                {{ form.description.label(class="auth-label") }}
                {{ form.description(class="auth-input", rows=3, placeholder="Optional description") }}
                {% if form.description.errors %}
                    <div class="auth-error-messages">
                        {% for error in form.description.errors %}
                            <span class="auth-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="auth-form-group">
                {{ form.list_type.label(class="auth-label") }}
                {{ form.list_type(class="auth-select") }}
                {% if form.list_type.errors %}
                    <div class="auth-error-messages">
                        {% for error in form.list_type.errors %}
                            <span class="auth-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="auth-form-group">
                <label for="list_access_code" class="auth-label">List Password (Optional)</label>
                <input type="text" 
                       name="list_password" 
                       id="list_access_code" 
                       class="auth-input" 
                       placeholder="Leave blank for open access" 
                       autocomplete="off"
                       data-lpignore="true" 
                       data-1p-ignore="true"
                       data-form-type="other"
                       onfocus="this.type='password';"
                       onblur="if(this.value===''){this.type='text';}">
                <small style="color: #666; font-size: 0.875rem; margin-top: 4px; display: block;">
                    Optional: Require a password for users to access this list (this is NOT your account password)
                </small>
                {% if form.list_password.errors %}
                    <div class="auth-error-messages">
                        {% for error in form.list_password.errors %}
                            <span class="auth-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="auth-form-group">
                <label class="auth-checkbox-label">
                    {{ form.allow_waitlist(class="auth-checkbox") }}
                    <span>{{ form.allow_waitlist.label.text }}</span>
                </label>
                <small style="color: #666; font-size: 0.875rem; margin-top: 4px; display: block;">
                    {{ form.allow_waitlist.description }}
                </small>
                {% if form.allow_waitlist.errors %}
                    <div class="auth-error-messages">
                        {% for error in form.allow_waitlist.errors %}
                            <span class="auth-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="auth-form-group">
                {{ form.max_signups_per_member.label(class="auth-label") }}
                {{ form.max_signups_per_member(class="auth-input", placeholder="Leave blank for no limit", type="number", min="1") }}
                <small style="color: #666; font-size: 0.875rem; margin-top: 4px; display: block;">
                    {{ form.max_signups_per_member.description }}
                </small>
                {% if form.max_signups_per_member.errors %}
                    <div class="auth-error-messages">
                        {% for error in form.max_signups_per_member.errors %}
                            <span class="auth-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div style="background-color: #f0f8ff; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #007bff;">
                <div class="auth-form-group" style="margin-bottom: 0.5rem;">
                    <label class="auth-checkbox-label">
                        {{ form.is_lottery(class="auth-checkbox", id="is_lottery_checkbox") }}
                        <span style="font-weight: 600;">{{ form.is_lottery.label.text }}</span>
                    </label>
                    <small style="color: #666; font-size: 0.875rem; margin-top: 4px; display: block;">
                        {{ form.is_lottery.description }}
                    </small>
                    {% if form.is_lottery.errors %}
                        <div class="auth-error-messages">
                            {% for error in form.is_lottery.errors %}
                                <span class="auth-error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div id="lottery_datetime_group" class="auth-form-group" style="display: none; margin-top: 1rem; margin-bottom: 0;">
                    {{ form.lottery_datetime.label(class="auth-label") }}
                    {{ form.lottery_datetime(class="auth-input") }}
                    <small style="color: #666; font-size: 0.875rem; margin-top: 4px; display: block;">
                        Times are in your timezone: <strong>{{ current_user.time_zone }}</strong>. 
                        The lottery will run within 1 hour after this time. Must be at least 1 hour in the future.
                    </small>
                    {% if form.lottery_datetime.errors %}
                        <div class="auth-error-messages">
                            {% for error in form.lottery_datetime.errors %}
                                <span class="auth-error">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="auth-form-group">
                {{ form.submit(class="auth-submit-btn") }}
            </div>
        </form>

        <script>
            // Show/hide lottery datetime field based on lottery checkbox
            const lotteryCheckbox = document.getElementById('is_lottery_checkbox');
            const lotteryDatetimeGroup = document.getElementById('lottery_datetime_group');

            function toggleLotteryDatetime() {
                if (lotteryCheckbox.checked) {
                    lotteryDatetimeGroup.style.display = 'block';
                } else {
                    lotteryDatetimeGroup.style.display = 'none';
                }
            }

            lotteryCheckbox.addEventListener('change', toggleLotteryDatetime);
            
            // Initialize on page load
            toggleLotteryDatetime();
        </script>

        <div class="auth-footer" style="margin-top: 2rem;">
            <p class="auth-footer-text"><a href="{{ url_for('better_signups.index') }}" class="auth-link">‚Üê Back to Better Signups</a></p>
        </div>
    </div>
</div>

{% endblock %}

