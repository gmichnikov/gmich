{% extends "base.html" %}

{% block title %}Browse {{ sport_key }} - BetFake{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('betfake.static', filename='betfake/style.css') }}">
<style>
    .bf-section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        user-select: none;
        padding: 5px 0;
    }
    .bf-section-header:hover h2 {
        color: var(--bf-secondary);
    }
    .bf-collapse-icon {
        transition: transform 0.3s ease;
        color: var(--bf-text-light);
    }
    .bf-collapsed .bf-collapse-icon {
        transform: rotate(-90deg);
    }
    .bf-collapsible-content {
        transition: max-height 0.3s ease-out, opacity 0.3s ease;
        overflow: hidden;
        max-height: 5000px; /* Large enough to show content */
        opacity: 1;
    }
    .bf-collapsed + .bf-collapsible-content {
        max-height: 0;
        opacity: 0;
        pointer-events: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="bf-page-wrapper">
    <div class="bf-dashboard-container">
        <nav class="bf-nav-tabs">
            <a href="{{ url_for('betfake.index') }}" class="bf-nav-link">Dashboard</a>
            {% for sport in active_sports %}
            <a href="{{ url_for('betfake.browse_sport', sport_key=sport.sport_key) }}" class="bf-nav-link {% if sport_key == sport.sport_key %}active{% endif %}">{{ sport.sport_title }}</a>
            {% endfor %}
            <a href="{{ url_for('betfake.futures') }}" class="bf-nav-link">Futures</a>
            <a href="{{ url_for('betfake.history') }}" class="bf-nav-link">History</a>
        </nav>

        <div class="bf-header">
            <h1>{{ sport_label }} Games</h1>
            <p>Select a line to place a bet.</p>
        </div>

        {% if upcoming_games %}
            <div class="bf-section-title bf-section-header" data-toggle="upcoming-content">
                <h2>Upcoming {{ sport_label }} Games</h2>
                <svg class="bf-collapse-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
            <div id="upcoming-content" class="bf-collapsible-content">
                {% for game in upcoming_games %}
                <div class="bf-game-card">
                    <div class="bf-game-header">
                        <a href="{{ url_for('betfake.game_detail', game_id=game.id) }}" style="text-decoration: none; color: inherit;">
                            <span class="bf-game-teams">{{ game.home_team }} vs {{ game.away_team }}</span>
                        </a>
                        <span class="bf-game-time">{{ (game.commence_time|bf_local_time).strftime('%m/%d %H:%M') }}</span>
                    </div>

                    <div class="bf-market-row" style="grid-template-columns: repeat({% if has_spreads %}3{% else %}1{% endif %}, 1fr);">
                        <!-- Moneyline Column -->
                        <div class="bf-market-column">
                            <span class="bf-market-label">Moneyline</span>
                            {% if 'h2h' in game.display_markets %}
                                {% for outcome in game.display_markets['h2h'].outcomes %}
                                <a href="{{ url_for('betfake.bet_page', outcome_id=outcome.id) }}" class="bf-odds-btn">
                                    <span class="bf-odds-name">{{ outcome.outcome_name }}</span>
                                    <span class="bf-odds-value">{{ outcome.odds|bf_odds }}</span>
                                </a>
                                {% endfor %}
                            {% else %}
                                <span style="font-size: 0.8rem; text-align: center; color: #999;">N/A</span>
                            {% endif %}
                        </div>

                        {% if has_spreads %}
                        <!-- Spreads Column -->
                        <div class="bf-market-column">
                            <span class="bf-market-label">Spread</span>
                            {% if 'spreads' in game.display_markets %}
                                {% for outcome in game.display_markets['spreads'].outcomes %}
                                <a href="{{ url_for('betfake.bet_page', outcome_id=outcome.id) }}" class="bf-odds-btn">
                                    <span class="bf-odds-name">{{ outcome.outcome_name }}</span>
                                    <span class="bf-odds-value">{{ outcome.odds|bf_odds }}</span>
                                    <span class="bf-odds-point">{{ outcome.point_value|bf_point }}</span>
                                </a>
                                {% endfor %}
                            {% else %}
                                <span style="font-size: 0.8rem; text-align: center; color: #999;">N/A</span>
                            {% endif %}
                        </div>

                        <!-- Totals Column -->
                        <div class="bf-market-column">
                            <span class="bf-market-label">Total</span>
                            {% if 'totals' in game.display_markets %}
                                {% for outcome in game.display_markets['totals'].outcomes %}
                                <a href="{{ url_for('betfake.bet_page', outcome_id=outcome.id) }}" class="bf-odds-btn">
                                    <span class="bf-odds-name">{{ outcome.outcome_name }}</span>
                                    <span class="bf-odds-value">{{ outcome.odds|bf_odds }}</span>
                                    <span class="bf-odds-point">{{ outcome.point_value }}</span>
                                </a>
                                {% endfor %}
                            {% else %}
                                <span style="font-size: 0.8rem; text-align: center; color: #999;">N/A</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="bf-placeholder-card" style="background: white; padding: 40px; text-align: center; border-radius: 10px; margin-bottom: 30px; border: 2px dashed var(--bf-border);">
                <p>No upcoming {{ sport_label }} games found.</p>
                <p>Try syncing data from the Admin panel.</p>
            </div>
        {% endif %}

        {% if recent_games %}
            <div class="bf-section-title bf-section-header" style="margin-top: 40px;" data-toggle="recent-content">
                <h2>Recent {{ sport_label }} Games</h2>
                <svg class="bf-collapse-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
            <div id="recent-content" class="bf-collapsible-content">
                {% for game in recent_games %}
                <div class="bf-game-card" style="background: #fdfdfd; opacity: 0.9;">
                    <div class="bf-game-header">
                        <a href="{{ url_for('betfake.game_detail', game_id=game.id) }}" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 15px; width: 100%;">
                            <div style="flex: 1; display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-weight: bold; font-size: 1rem; color: #444;">{{ game.home_team }}</span>
                                {% if game.home_score is not none %}
                                    <span style="font-size: 1.2rem; font-weight: 900; min-width: 30px; text-align: center;">{{ game.home_score }}</span>
                                {% else %}
                                    <span style="color: #ccc;">--</span>
                                {% endif %}
                            </div>
                            
                            <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px;">
                                <span class="bf-game-status-big bf-game-status-{{ game.status.value.lower() }}" style="font-size: 0.65rem; padding: 2px 8px;">
                                    {{ game.status.value }}
                                </span>
                                <span style="font-size: 0.7rem; color: #999; margin-top: 4px;">{{ (game.commence_time|bf_local_time).strftime('%m/%d') }}</span>
                            </div>

                            <div style="flex: 1; display: flex; align-items: center; justify-content: space-between; flex-direction: row-reverse;">
                                <span style="font-weight: bold; font-size: 1rem; color: #444;">{{ game.away_team }}</span>
                                {% if game.away_score is not none %}
                                    <span style="font-size: 1.2rem; font-weight: 900; min-width: 30px; text-align: center;">{{ game.away_score }}</span>
                                {% else %}
                                    <span style="color: #ccc;">--</span>
                                {% endif %}
                            </div>
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggles = document.querySelectorAll('.bf-section-header');
        toggles.forEach(toggle => {
            toggle.addEventListener('click', function() {
                this.classList.toggle('bf-collapsed');
            });
        });
    });
</script>
{% endblock %}
