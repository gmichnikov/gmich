{% extends "base.html" %}

{% block title %}BetFake - Sports Betting Simulator{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('betfake.static', filename='betfake/style.css') }}">
{% endblock %}

{% block content %}
<div class="bf-page-wrapper">
    <div class="bf-dashboard-container">
        <nav class="bf-nav-tabs">
            <a href="{{ url_for('betfake.index') }}" class="bf-nav-link active">Dashboard</a>
            <a href="{{ url_for('betfake.browse_sport', sport_key='basketball_nba') }}" class="bf-nav-link">NBA</a>
            <a href="{{ url_for('betfake.browse_sport', sport_key='americanfootball_nfl') }}" class="bf-nav-link">NFL</a>
            <a href="{{ url_for('betfake.browse_sport', sport_key='soccer_epl') }}" class="bf-nav-link">EPL</a>
            <a href="{{ url_for('betfake.futures') }}" class="bf-nav-link">Futures</a>
            <a href="{{ url_for('betfake.history') }}" class="bf-nav-link">History</a>
        </nav>

        <div class="bf-header">
            <h1>BetFake Dashboard</h1>
            <p>Real-time odds. Fake money.</p>
        </div>

    <div class="bf-stats-grid">
        <div class="bf-stat-card">
            <span class="bf-stat-label">Total Balance</span>
            <span class="bf-stat-value">{{ total_balance|bf_currency }}</span>
        </div>
        <div class="bf-stat-card">
            <span class="bf-stat-label">Total Equity</span>
            <span class="bf-stat-value" style="color: var(--bf-accent);">{{ total_equity|bf_currency }}</span>
        </div>
        <div class="bf-stat-card">
            <span class="bf-stat-label">Total Profit/Loss</span>
            <span class="bf-stat-value {% if total_pl > 0 %}bf-positive{% elif total_pl < 0 %}bf-negative{% endif %}">
                {{ formatted_total_pl }}
            </span>
        </div>
        <div class="bf-stat-card">
            <span class="bf-stat-label">Pending Bets</span>
            <span class="bf-stat-value" style="color: var(--bf-pending);">{{ pending_bets|length }}</span>
        </div>
    </div>

        <div class="bf-section-title">
            <h2>My Betting Accounts</h2>
        </div>

        {% if accounts %}
        <div class="bf-accounts-grid">
            {% for account in accounts %}
            {% set acc_pl = account_pls.get(account.id) %}
            <div class="bf-account-card" onclick="window.location.href='{{ url_for('betfake.transactions', account_id=account.id) }}'">
            <div class="bf-account-header">
                <div>
                    <span class="bf-account-name">{{ account.name }}</span>
                    {% if acc_pl and acc_pl.raw != 0 %}
                    <div style="font-size: 0.75rem; font-weight: bold; margin-top: 2px;" class="{% if acc_pl.raw > 0 %}bf-positive{% else %}bf-negative{% endif %}">
                        P/L: {{ acc_pl.formatted }}
                    </div>
                    {% endif %}
                </div>
                <span class="bf-account-balance">{{ account.balance|bf_currency }}</span>
            </div>
                <div class="bf-account-actions">
                    <span class="bf-btn bf-btn-outline bf-btn-sm">Transactions</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="bf-placeholder-card" style="background: white; padding: 40px; text-align: center; border-radius: 10px; margin-bottom: 30px; border: 2px dashed var(--bf-border);">
            <p>You don't have any betting accounts yet.</p>
            <p>Create your first account below to get $100.00 in fake money!</p>
        </div>
        {% endif %}

        <div class="bf-create-account-form">
            <h3>Create New Betting Account</h3>
            <form action="{{ url_for('betfake.create_account') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="bf-form-group">
                    <input type="text" name="name" class="bf-form-input" placeholder="e.g., My Main Account" required>
                    <button type="submit" class="bf-btn bf-btn-primary">Create & Get $100</button>
                </div>
            </form>
        </div>

        <div class="bf-section-title">
            <h2>Pending Bets</h2>
        </div>

        <div class="bf-pending-bets-card">
            {% if pending_bets %}
            <ul class="bf-bet-list">
                {% for bet in pending_bets %}
                <li class="bf-bet-item">
                    <div class="bf-bet-info">
                        <h4>{{ bet|bf_bet_outcome }}</h4>
                        <div class="bf-bet-meta">
                            {% if bet.outcome.market.game.home_team and bet.outcome.market.game.away_team %}
                                <a href="{{ url_for('betfake.game_detail', game_id=bet.outcome.market.game.id) }}" style="color: var(--bf-primary); text-decoration: none; font-weight: 500;">
                                    {{ bet.outcome.market.game.home_team }} vs {{ bet.outcome.market.game.away_team }}
                                </a>
                            {% else %}
                                {{ bet.outcome.market.game.sport_title }}
                            {% endif %}
                            <span style="font-size: 0.75rem; margin-left: 5px; color: #888;">
                                ({{ (bet.outcome.market.game.commence_time|bf_local_time).strftime('%m/%d %H:%M') }})
                            </span>
                            <br>
                            Odds: {{ bet.odds_at_time|bf_odds }} | Account: {{ bet.account.name }}
                        </div>
                    </div>
                <div class="bf-bet-wager">
                    <span class="bf-wager-amount">{{ bet.wager_amount|bf_currency }}</span>
                    <span style="font-size: 0.7rem; color: var(--bf-secondary); margin-top: 4px;">
                        To win: {{ (bet.potential_payout - bet.wager_amount)|bf_currency }}
                    </span>
                </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p style="text-align: center; color: var(--bf-text-light); margin: 20px 0;">No active bets at the moment. Time to place some wagers!</p>
            <div style="text-align: center;">
                <a href="{{ url_for('betfake.browse_sport', sport_key='basketball_nba') }}" class="bf-btn bf-btn-primary">Browse NBA Games</a>
            </div>
            {% endif %}
        </div>

        {% if recent_settled %}
        <div class="bf-section-title" style="margin-top: 40px;">
            <h2>Recently Settled</h2>
            <a href="{{ url_for('betfake.history') }}" style="font-size: 0.9rem; color: var(--bf-primary); text-decoration: none; font-weight: bold;">View Full History â†’</a>
        </div>
        <div class="bf-pending-bets-card" style="border-bottom: 4px solid var(--bf-secondary);">
            <ul class="bf-bet-list">
                {% for bet in recent_settled %}
                <li class="bf-bet-item">
                    <div class="bf-bet-info">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                            <h4 style="margin: 0;">{{ bet|bf_bet_outcome }}</h4>
                            <span class="bf-status-pill bf-status-{{ bet.status.value.lower() }}" style="font-size: 0.65rem; padding: 2px 6px;">
                                {{ bet.status.value }}
                            </span>
                        </div>
                        <div class="bf-bet-meta">
                            {% if bet.outcome.market.game.home_team and bet.outcome.market.game.away_team %}
                                <a href="{{ url_for('betfake.game_detail', game_id=bet.outcome.market.game.id) }}" style="color: var(--bf-primary); text-decoration: none; font-weight: 500;">
                                    {{ bet.outcome.market.game.home_team }} vs {{ bet.outcome.market.game.away_team }}
                                </a>
                            {% else %}
                                {{ bet.outcome.market.game.sport_title }}
                            {% endif %}
                            <br>
                            Account: {{ bet.account.name }}
                        </div>
                    </div>
                    <div class="bf-bet-wager" style="text-align: right;">
                        {% if bet.status.value == 'Won' %}
                            <span class="bf-positive" style="font-weight: bold; font-size: 1.1rem;">+{{ (bet.potential_payout - bet.wager_amount)|bf_currency }}</span>
                        {% elif bet.status.value == 'Lost' %}
                            <span class="bf-negative" style="font-weight: bold; font-size: 1.1rem;">-{{ bet.wager_amount|bf_currency }}</span>
                        {% elif bet.status.value == 'Push' %}
                            <span style="font-weight: bold; font-size: 1.1rem; color: #856404;">PUSH</span>
                        {% endif %}
                        <div style="font-size: 0.75rem; color: #999;">{{ bet.wager_amount|bf_currency }} wager</div>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% else %}
        <div class="bf-section-title" style="margin-top: 40px;">
            <h2>Recently Settled</h2>
        </div>
        <div class="bf-placeholder-card" style="background: white; padding: 20px; text-align: center; border-radius: 10px; border: 1px solid var(--bf-border); opacity: 0.7;">
            <p style="margin: 0; font-size: 0.9rem; color: var(--bf-text-light);">No recently settled bets. Results will appear here once your games finish!</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
